(function(e){"use strict";function n(t){Object.assign(t,{properties:{masterVol:{type:Number,value:.5,observer:"setMasterVol"},reverbLev:{type:Number,value:.3,observer:"setReverbLev"},quality:{type:Number,value:1,observer:"setQuality"},debug:{type:Number,value:0},src:{type:String,value:null,observer:"loadMIDIfromSrc"},loop:{type:Number,value:0},internalcontext:{type:Number,value:1},tsmode:{type:Number,value:0},voices:{type:Number,value:64},useReverb:{type:Number,value:1},width:{type:String,value:"300px",observer:"layout"},height:{type:String,value:"32px",observer:"layout"},graph:{type:Number,value:1},disabledrop:{type:Number,value:0},perfmon:{type:Number,value:0}},layout:function(){this.canvas.style.width=this.width;this.canvas.style.height=this.height},program:[{name:"Acoustic Grand Piano"},{name:"Bright Acoustic Piano"},{name:"Electric Grand Piano"},{name:"Honky-tonk Piano"},{name:"Electric Piano 1"},{name:"Electric Piano 2"},{name:"Harpsichord"},{name:"Clavi"},{name:"Celesta"},{name:"Glockenspiel"},{name:"Music Box"},{name:"Vibraphone"},{name:"Marimba"},{name:"Xylophone"},{name:"Tubular Bells"},{name:"Dulcimer"},{name:"Drawbar Organ"},{name:"Percussive Organ"},{name:"Rock Organ"},{name:"Church Organ"},{name:"Reed Organ"},{name:"Accordion"},{name:"Harmonica"},{name:"Tango Accordion"},{name:"Acoustic Guitar (nylon)"},{name:"Acoustic Guitar (steel)"},{name:"Electric Guitar (jazz)"},{name:"Electric Guitar (clean)"},{name:"Electric Guitar (muted)"},{name:"Overdriven Guitar"},{name:"Distortion Guitar"},{name:"Guitar harmonics"},{name:"Acoustic Bass"},{name:"Electric Bass (finger)"},{name:"Electric Bass (pick)"},{name:"Fretless Bass"},{name:"Slap Bass 1"},{name:"Slap Bass 2"},{name:"Synth Bass 1"},{name:"Synth Bass 2"},{name:"Violin"},{name:"Viola"},{name:"Cello"},{name:"Contrabass"},{name:"Tremolo Strings"},{name:"Pizzicato Strings"},{name:"Orchestral Harp"},{name:"Timpani"},{name:"String Ensemble 1"},{name:"String Ensemble 2"},{name:"SynthStrings 1"},{name:"SynthStrings 2"},{name:"Choir Aahs"},{name:"Voice Oohs"},{name:"Synth Voice"},{name:"Orchestra Hit"},{name:"Trumpet"},{name:"Trombone"},{name:"Tuba"},{name:"Muted Trumpet"},{name:"French Horn"},{name:"Brass Section"},{name:"SynthBrass 1"},{name:"SynthBrass 2"},{name:"Soprano Sax"},{name:"Alto Sax"},{name:"Tenor Sax"},{name:"Baritone Sax"},{name:"Oboe"},{name:"English Horn"},{name:"Bassoon"},{name:"Clarinet"},{name:"Piccolo"},{name:"Flute"},{name:"Recorder"},{name:"Pan Flute"},{name:"Blown Bottle"},{name:"Shakuhachi"},{name:"Whistle"},{name:"Ocarina"},{name:"Lead 1 (square)"},{name:"Lead 2 (sawtooth)"},{name:"Lead 3 (calliope)"},{name:"Lead 4 (chiff)"},{name:"Lead 5 (charang)"},{name:"Lead 6 (voice)"},{name:"Lead 7 (fifths)"},{name:"Lead 8 (bass + lead)"},{name:"Pad 1 (new age)"},{name:"Pad 2 (warm)"},{name:"Pad 3 (polysynth)"},{name:"Pad 4 (choir)"},{name:"Pad 5 (bowed)"},{name:"Pad 6 (metallic)"},{name:"Pad 7 (halo)"},{name:"Pad 8 (sweep)"},{name:"FX 1 (rain)"},{name:"FX 2 (soundtrack)"},{name:"FX 3 (crystal)"},{name:"FX 4 (atmosphere)"},{name:"FX 5 (brightness)"},{name:"FX 6 (goblins)"},{name:"FX 7 (echoes)"},{name:"FX 8 (sci-fi)"},{name:"Sitar"},{name:"Banjo"},{name:"Shamisen"},{name:"Koto"},{name:"Kalimba"},{name:"Bag pipe"},{name:"Fiddle"},{name:"Shanai"},{name:"Tinkle Bell"},{name:"Agogo"},{name:"Steel Drums"},{name:"Woodblock"},{name:"Taiko Drum"},{name:"Melodic Tom"},{name:"Synth Drum"},{name:"Reverse Cymbal"},{name:"Guitar Fret Noise"},{name:"Breath Noise"},{name:"Seashore"},{name:"Bird Tweet"},{name:"Telephone Ring"},{name:"Helicopter"},{name:"Applause"},{name:"Gunshot"}],drummap:[{name:"Acoustic Bass Drum"},{name:"Bass Drum 1"},{name:"Side Stick"},{name:"Acoustic Snare"},{name:"Hand Clap"},{name:"Electric Snare"},{name:"Low Floor Tom"},{name:"Closed Hi Hat"},{name:"High Floor Tom"},{name:"Pedal Hi-Hat"},{name:"Low Tom"},{name:"Open Hi-Hat"},{name:"Low-Mid Tom"},{name:"Hi-Mid Tom"},{name:"Crash Cymbal 1"},{name:"High Tom"},{name:"Ride Cymbal 1"},{name:"Chinese Cymbal"},{name:"Ride Bell"},{name:"Tambourine"},{name:"Splash Cymbal"},{name:"Cowbell"},{name:"Crash Cymbal 2"},{name:"Vibraslap"},{name:"Ride Cymbal 2"},{name:"Hi Bongo"},{name:"Low Bongo"},{name:"Mute Hi Conga"},{name:"Open Hi Conga"},{name:"Low Conga"},{name:"High Timbale"},{name:"Low Timbale"},{name:"High Agogo"},{name:"Low Agogo"},{name:"Cabasa"},{name:"Maracas"},{name:"Short Whistle"},{name:"Long Whistle"},{name:"Short Guiro"},{name:"Long Guiro"},{name:"Claves"},{name:"Hi Wood Block"},{name:"Low Wood Block"},{name:"Mute Cuica"},{name:"Open Cuica"},{name:"Mute Triangle"},{name:"Open Triangle"}],program1:[[{w:"sine",v:.4,d:.7,r:.1},{w:"triangle",v:3,d:.7,s:.1,g:1,a:.01,k:-1.2}],[{w:"triangle",v:.4,d:.7,r:.1},{w:"triangle",v:4,t:3,d:.4,s:.1,g:1,k:-1,a:.01}],[{w:"sine",d:.7,r:.1},{w:"triangle",v:4,f:2,d:.5,s:.5,g:1,k:-1}],[{w:"sine",d:.7,v:.2},{w:"triangle",v:4,t:3,f:2,d:.3,g:1,k:-1,a:.01,s:.5}],[{w:"sine",v:.35,d:.7},{w:"sine",v:3,t:7,f:1,d:1,s:1,g:1,k:-.7}],[{w:"sine",v:.35,d:.7},{w:"sine",v:8,t:7,f:1,d:.5,s:1,g:1,k:-.7}],[{w:"sawtooth",v:.34,d:2},{w:"sine",v:8,f:.1,d:2,s:1,r:2,g:1}],[{w:"triangle",v:.34,d:1.5},{w:"square",v:6,f:.1,d:1.5,s:.5,r:2,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:11,t:6,d:.2,s:.4,g:1}],[{w:"sine",v:.2,d:.3,r:.3},{w:"sine",v:11,t:5,d:.1,s:.4,g:1}],[{w:"sine",v:.2,d:.6,r:.6},{w:"triangle",v:11,t:5,f:1,s:.5,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:6,t:5,d:.02,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",v:.2,d:1,r:1},{w:"sine",v:11,t:3.5,d:1,r:1,g:1}],[{w:"triangle",v:.2,d:.5,r:.2},{w:"sine",v:6,t:2.5,d:.2,s:.1,r:.2,g:1}],[{w:"w9999",v:.22,s:.9},{w:"w9999",v:.22,t:2,f:2,s:.9}],[{w:"w9999",v:.2,s:1},{w:"sine",v:11,t:6,f:2,s:.1,g:1,h:.006,r:.002,d:.002},{w:"w9999",v:.2,t:2,f:1,h:0,s:1}],[{w:"w9999",v:.2,d:.1,s:.9},{w:"w9999",v:.25,t:4,f:2,s:.5}],[{w:"w9999",v:.3,a:.04,s:.9},{w:"w9999",v:.2,t:8,f:2,a:.04,s:.9}],[{w:"sine",v:.2,a:.02,d:.05,s:1},{w:"sine",v:6,t:3,f:1,a:.02,d:.05,s:1,g:1}],[{w:"triangle",v:.2,a:.02,d:.05,s:.8},{w:"square",v:7,t:3,f:1,d:.05,s:1.5,g:1}],[{w:"square",v:.2,a:.02,d:.2,s:.5},{w:"square",v:1,d:.03,s:2,g:1}],[{w:"square",v:.2,a:.02,d:.1,s:.8},{w:"square",v:1,a:.3,d:.1,s:2,g:1}],[{w:"sine",v:.3,d:.5,f:1},{w:"triangle",v:5,t:3,f:-1,d:1,s:.1,g:1}],[{w:"sine",v:.4,d:.6,f:1},{w:"triangle",v:12,t:3,d:.6,s:.1,g:1,f:-1}],[{w:"triangle",v:.3,d:1,f:1},{w:"triangle",v:6,f:-1,d:.4,s:.5,g:1,t:3}],[{w:"sine",v:.3,d:1,f:-1},{w:"triangle",v:11,f:1,d:.4,s:.5,g:1,t:3}],[{w:"sine",v:.4,d:.1,r:.01},{w:"sine",v:7,g:1}],[{w:"triangle",v:.4,d:1,f:1},{w:"square",v:4,f:-1,d:1,s:.7,g:1}],[{w:"triangle",v:.35,d:1,f:1},{w:"square",v:7,f:-1,d:.3,s:.5,g:1}],[{w:"sine",v:.2,t:1.5,a:.005,h:.2,d:.6},{w:"sine",v:11,t:5,f:2,d:1,s:.5,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"w9999",d:.3,v:.7,s:.5},{w:"sawtooth",v:1.2,d:.02,s:.5,g:1,h:0,r:.02}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sine",v:.4,a:.1,d:11},{w:"sine",v:6,f:2.5,d:.05,s:1.1,g:1}],[{w:"sine",v:.3,d:.1,r:.1},{w:"square",v:4,t:3,d:1,s:.2,g:1}],[{w:"sine",v:.3,d:.5,r:.5},{w:"sine",v:7,t:2,f:2,d:1,r:1,g:1}],[{w:"triangle",v:.6,h:.03,d:.3,r:.3,t:.5},{w:"n0",v:8,t:1.5,d:.08,r:.08,g:1}],[{w:"sawtooth",v:.3,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.3,f:-2,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,t:2,f:2,a:1,d:1,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,f:2,a:.02,d:1,s:1}],[{w:"triangle",v:.3,a:.03,s:1},{w:"sine",v:3,t:5,f:1,d:1,s:1,g:1}],[{w:"sine",v:.4,a:.03,s:.9},{w:"sine",v:1,t:2,f:3,d:.03,s:.2,g:1}],[{w:"triangle",v:.6,a:.05,s:.5},{w:"sine",v:1,f:.8,d:.2,s:.2,g:1}],[{w:"square",v:.15,a:.01,d:.2,r:.2,t:.5,h:.03},{w:"square",v:4,f:.5,d:.2,r:11,a:.01,g:1,h:.02},{w:"square",v:.15,t:4,f:1,a:.02,d:.15,r:.15,h:.03},{g:3,w:"square",v:4,f:-.5,a:.01,h:.02,d:.15,r:11}],[{w:"square",v:.2,a:.01,d:1,s:.6,r:.04},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.04,d:1,s:.4,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.15,a:.04,s:1},{w:"sine",v:2,d:.1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6,r:.08},{w:"sine",v:1,f:.2,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:.5,s:.7,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"sine",v:.4,a:.02,d:.7,s:.5},{w:"square",v:5,t:2,d:.2,s:.5,g:1}],[{w:"sine",v:.3,a:.05,d:.2,s:.8},{w:"sawtooth",v:6,f:.1,d:.1,s:.3,g:1}],[{w:"sine",v:.3,a:.03,d:.2,s:.4},{w:"square",v:7,f:.2,d:1,s:.1,g:1}],[{w:"square",v:.2,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",a:.02,d:2},{w:"sine",v:6,t:2,d:.04,g:1}],[{w:"sine",v:.7,a:.03,d:.4,s:.4},{w:"sine",v:4,t:2,f:.2,d:.4,g:1}],[{w:"sine",v:.7,a:.02,d:.4,s:.6},{w:"sine",v:3,t:2,d:0,s:1,g:1}],[{w:"sine",v:.4,a:.06,d:.3,s:.3},{w:"sine",v:7,t:2,d:.2,s:.2,g:1}],[{w:"sine",a:.02,d:.3,s:.3},{w:"sawtooth",v:3,t:2,d:.3,g:1}],[{w:"sine",v:.4,a:.02,d:2,s:.1},{w:"sawtooth",v:8,t:2,f:1,d:.5,g:1}],[{w:"sine",v:.7,a:.03,d:.5,s:.3},{w:"sine",v:.003,t:0,f:4,d:.1,s:.002,g:1}],[{w:"sine",v:.7,a:.02,d:2},{w:"sine",v:1,t:2,f:1,d:.02,g:1}],[{w:"square",v:.3,d:1,s:.5},{w:"square",v:1,f:.2,d:1,s:.5,g:1}],[{w:"sawtooth",v:.3,d:2,s:.5},{w:"square",v:2,f:.1,s:.5,g:1}],[{w:"triangle",v:.5,a:.05,d:2,s:.6},{w:"sine",v:4,t:2,g:1}],[{w:"triangle",v:.3,a:.01,d:2,s:.3},{w:"sine",v:22,t:2,f:1,d:.03,s:.2,g:1}],[{w:"sawtooth",v:.3,d:1,s:.5},{w:"sine",v:11,t:11,a:.2,d:.05,s:.3,g:1}],[{w:"sine",v:.3,a:.06,d:1,s:.5},{w:"sine",v:7,f:1,d:1,s:.2,g:1}],[{w:"sawtooth",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sawtooth",v:.3,t:.75,d:.7,a:.1,s:.3,r:.2}],[{w:"triangle",v:.3,a:.01,d:.7,s:.5},{w:"square",v:5,t:.5,d:.7,s:.5,g:1}],[{w:"triangle",v:.3,a:.02,d:.3,s:.3,r:.3},{w:"square",v:3,t:4,f:1,a:.02,d:.1,s:1,g:1},{w:"triangle",v:.08,t:.5,a:.1,h:0,d:.1,s:.5,r:.1,b:0,c:0}],[{w:"sine",v:.3,a:.05,d:1,s:.7,r:.3},{w:"sine",v:2,f:1,d:.3,s:1,g:1}],[{w:"square",v:.3,a:.03,d:.5,s:.3,r:.1},{w:"square",v:4,f:1,a:.03,d:.1,g:1}],[{w:"triangle",v:.3,a:.08,d:1,s:.3,r:.1},{w:"square",v:2,f:1,d:.3,s:.3,g:1,t:4,a:.08}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sine",v:.1,t:2.001,f:1,d:1,s:50,g:1}],[{w:"triangle",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sine",v:12,t:7,f:1,d:.5,s:1.7,g:1}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sawtooth",v:22,t:6,d:.06,s:.3,g:1}],[{w:"triangle",v:.3,a:.05,d:11,r:.3},{w:"triangle",v:1,d:1,s:8,g:1}],[{w:"sawtooth",v:.3,d:4,s:.8,r:.1},{w:"square",v:1,t:2,f:8,a:1,d:1,s:1,r:.1,g:1}],[{w:"triangle",v:.3,d:1,s:.5,t:.8,a:.2,p:1.25,q:.2},{w:"sawtooth",v:.2,a:.2,d:.3,s:1,t:1.2,p:1.25,q:.2}],[{w:"sine",v:.3,d:1,s:.3},{w:"square",v:22,t:11,d:.5,s:.1,g:1}],[{w:"sawtooth",v:.3,a:.04,d:1,s:.8,r:.1},{w:"square",v:1,t:.5,d:1,s:2,g:1}],[{w:"triangle",v:.3,d:1,s:.3},{w:"sine",v:22,t:6,d:.6,s:.05,g:1}],[{w:"sine",v:.6,a:.1,d:.05,s:.4},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"sine",a:.1,d:.05,s:.4,v:.8},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"square",v:.3,a:.1,d:.1,s:.4},{w:"square",v:1,f:1,d:.3,s:.1,g:1}],[{w:"sawtooth",v:.3,d:.5,r:.5},{w:"sawtooth",v:11,t:5,d:.05,g:1}],[{w:"square",v:.3,d:.2,r:.2},{w:"square",v:7,t:3,d:.05,g:1}],[{w:"triangle",d:.2,r:.2},{w:"square",v:9,t:3,d:.1,r:.1,g:1}],[{w:"triangle",d:.3,r:.3},{w:"square",v:6,t:3,d:1,r:1,g:1}],[{w:"triangle",v:.4,d:.2,r:.2},{w:"square",v:22,t:12,d:.1,r:.1,g:1}],[{w:"sine",v:.25,a:.02,d:.05,s:.8},{w:"square",v:1,t:2,d:.03,s:11,g:1}],[{w:"sine",v:.3,a:.05,d:11},{w:"square",v:7,t:3,f:1,s:.7,g:1}],[{w:"square",v:.3,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",v:.4,d:.3,r:.3},{w:"sine",v:7,t:9,d:.1,r:.1,g:1}],[{w:"sine",v:.7,d:.1,r:.1},{w:"sine",v:22,t:7,d:.05,g:1}],[{w:"sine",v:.6,d:.15,r:.15},{w:"square",v:11,t:3.2,d:.1,r:.1,g:1}],[{w:"sine",v:.8,d:.07,r:.07},{w:"square",v:11,t:7,r:.01,g:1}],[{w:"triangle",v:.7,t:.5,d:.2,r:.2,p:.95},{w:"n0",v:9,g:1,d:.2,r:.2}],[{w:"sine",v:.7,d:.1,r:.1,p:.9},{w:"square",v:14,t:2,d:.005,r:.005,g:1}],[{w:"square",d:.15,r:.15,p:.5},{w:"square",v:4,t:5,d:.001,r:.001,g:1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"sine",t:12.5,d:0,r:0,p:.5,v:.3,h:.2,q:.5},{g:1,w:"sine",v:1,t:2,d:0,r:0,s:1},{g:1,w:"n0",v:.2,t:2,a:.6,h:0,d:.1,r:.1,b:0,c:0}],[{w:"n0",v:.2,a:.05,h:.02,d:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.1,d:1,s:.5},{w:"sine",v:4,t:0,f:1.5,d:1,s:1,r:.1,g:1},{g:1,w:"sine",v:4,t:0,f:2,a:.6,h:0,d:.1,s:1,r:.1,b:0,c:0}],[{w:"square",v:.3,t:.25,d:11,s:1},{w:"square",v:12,t:0,f:8,d:1,s:1,r:11,g:1}],[{w:"n0",v:.4,t:.5,a:1,d:11,s:1,r:.5},{w:"square",v:1,t:0,f:14,d:1,s:1,r:11,g:1}],[{w:"sine",t:0,f:1221,a:.2,d:1,r:.25,s:1},{g:1,w:"n0",v:3,t:.5,d:1,s:1,r:1}],[{w:"sine",d:.4,r:.4,p:.1,t:2.5,v:1},{w:"n0",v:12,t:2,d:1,r:1,g:1}]],program0:[[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sine",v:.5,d:.3,r:.3}],[{w:"triangle",v:.5,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"square",v:.2,d:1,r:1}],[{w:"sawtooth",v:.3,d:.7,r:.7}],[{w:"sine",v:.5,a:.01,s:1}],[{w:"sine",v:.7,d:.02,s:.7}],[{w:"square",v:.2,s:1}],[{w:"triangle",v:.5,a:.01,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.05,s:1}],[{w:"triangle",v:.5,d:.5}],[{w:"square",v:.2,d:.6}],[{w:"square",v:.2,d:.6}],[{w:"triangle",v:.8,d:.6}],[{w:"triangle",v:.4,d:.05}],[{w:"square",v:.2,d:1}],[{w:"square",v:.2,d:1}],[{w:"sine",v:.4,d:.6}],[{w:"triangle",v:.7,d:.4}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.1,s:.2}],[{w:"sawtooth",v:.4,d:.1,s:.2}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.3,d:.1}],[{w:"sawtooth",v:.3,d:.5,r:.5}],[{w:"triangle",v:.6,d:.1,r:.1,h:.03,p:.8}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"triangle",v:.3,a:.03,s:1}],[{w:"sine",v:.3,a:.03,s:1}],[{w:"triangle",v:.3,a:.05,s:1}],[{w:"sawtooth",v:.5,a:.01,d:.1}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.2,a:.05,d:.01,s:1}],[{w:"square",v:.3,a:.05,s:1}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.04,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.05,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"square",v:.3,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"triangle",v:.5,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"sawtooth",v:.4,d:12}],[{w:"sine",v:.4,a:.06,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.3,d:12}],[{w:"triangle",v:.5,d:12}],[{w:"square",v:.3,d:12}],[{w:"triangle",v:.5,a:.08,d:11}],[{w:"sawtooth",v:.5,a:.05,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.5,a:.04,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,a:.8,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.3,d:1,r:1}],[{w:"sawtooth",v:.5,d:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"square",v:.3,d:.2,r:.2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"sawtooth",v:.2,a:.02,d:.7}],[{w:"triangle",v:.5,d:1}],[{w:"sawtooth",v:.3,d:.3,r:.3}],[{w:"sine",v:.8,d:.1,r:.1}],[{w:"square",v:.2,d:.1,r:.1,p:1.05}],[{w:"sine",v:.8,d:.05,r:.05}],[{w:"triangle",v:.5,d:.1,r:.1,p:.96}],[{w:"triangle",v:.5,d:.1,r:.1,p:.97}],[{w:"square",v:.3,d:.1,r:.1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"triangle",v:.5,d:.03,t:0,f:1332,r:.001,p:1.1}],[{w:"n0",v:.2,t:.1,d:.02,a:.05,h:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.8,d:1,t:0,f:1832}],[{w:"triangle",d:.5,t:0,f:444,s:1}],[{w:"n0",v:.4,d:1,t:0,f:22,s:1}],[{w:"n0",v:.5,a:.2,d:11,t:0,f:44}],[{w:"n0",v:.5,t:.25,d:.4,r:.4}]],drummap1:[[{w:"triangle",t:0,f:70,v:1,d:.05,h:.03,p:.9,q:.1},{w:"n0",g:1,t:6,v:17,r:.01,h:0,p:0}],[{w:"triangle",t:0,f:88,v:1,d:.05,h:.03,p:.5,q:.1},{w:"n0",g:1,t:5,v:42,r:.01,h:0,p:0}],[{w:"n0",f:222,p:0,t:0,r:.01,h:0}],[{w:"triangle",v:.3,f:180,d:.05,t:0,h:.03,p:.9,q:.1},{w:"n0",v:.6,t:0,f:70,h:.02,r:.01,p:0},{g:1,w:"square",v:2,t:0,f:360,r:.01,b:0,c:0}],[{w:"square",f:1150,v:.34,t:0,r:.03,h:.025,d:.03},{g:1,w:"n0",t:0,f:13,h:.025,d:.1,s:1,r:.1,v:1}],[{w:"triangle",f:200,v:1,d:.06,t:0,r:.06},{w:"n0",g:1,t:0,f:400,v:12,r:.02,d:.02}],[{w:"triangle",f:100,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.4,h:.015,d:.005,r:.005}],[{w:"n1",f:390,v:.25,r:.01,t:0}],[{w:"triangle",f:120,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.5,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,r:.03,t:0,h:.005,d:.03}],[{w:"triangle",f:140,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,t:0,d:.2,r:.2},{w:"n0",v:.3,t:0,c:0,f:440,h:.005,d:.05}],[{w:"triangle",f:155,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"triangle",f:180,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],[{w:"triangle",f:220,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",f:500,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.1,t:0,r:.01,f:440}],[{w:"n1",v:.3,f:800,d:.2,r:.2,h:.05,t:0},{w:"square",t:0,v:1,d:.1,r:.1,p:.1,f:220,g:1}],[{w:"sine",f:1651,v:.15,d:.2,r:.2,h:0,t:0},{w:"sawtooth",g:1,t:1.21,v:7.2,d:.1,r:11,h:1},{g:1,w:"n0",v:3.1,t:.152,d:.002,r:.002}],null,[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],null,[{w:"n1",v:.3,f:555,d:.25,r:.25,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,f:440,a:.005,h:.02}],[{w:"sawtooth",f:776,v:.2,d:.3,t:0,r:.3},{g:1,w:"n0",v:2,t:0,f:776,a:.005,h:.02,d:.1,s:1,r:.1,c:0},{g:11,w:"sine",v:.1,t:0,f:22,d:.3,r:.3,b:0,c:0}],[{w:"n1",f:440,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.4,t:0,r:.01,f:440}],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[{w:"sine",f:1720,v:.3,d:.02,t:0,r:.02},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}],[{w:"sine",f:1720,v:.3,d:.25,t:0,r:.25},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}]],drummap0:[[{w:"triangle",t:0,f:110,v:1,d:.05,h:.02,p:.1}],[{w:"triangle",t:0,f:150,v:.8,d:.1,p:.1,h:.02,r:.01}],[{w:"n0",f:392,v:.5,d:.01,p:0,t:0,r:.05}],[{w:"n0",f:33,d:.05,t:0}],[{w:"n0",f:100,v:.7,d:.03,t:0,r:.03,h:.02}],[{w:"n0",f:44,v:.7,d:.02,p:.1,t:0,h:.02}],[{w:"triangle",f:240,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,r:.01,t:0}],[{w:"triangle",f:270,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.04,r:.04,t:0}],[{w:"triangle",f:300,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.1,r:.1,h:.02,t:0}],[{w:"triangle",f:320,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"triangle",f:360,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.1,h:.05,t:0,p:.1}],[{w:"triangle",f:400,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:440,v:.3,d:.1,p:.9,t:0,r:.1}],[{w:"n0",f:200,v:.2,d:.05,p:.9,t:0}],[{w:"n0",f:440,v:.3,d:.12,p:.9,t:0}],[{w:"sine",f:800,v:.4,d:.06,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:33,v:.3,d:.2,p:.9,t:0}],[{w:"n0",f:300,v:.3,d:.14,p:.9,t:0}],[{w:"sine",f:200,d:.06,t:0}],[{w:"sine",f:150,d:.06,t:0}],[{w:"sine",f:300,t:0}],[{w:"sine",f:300,d:.06,t:0}],[{w:"sine",f:250,d:.06,t:0}],[{w:"square",f:300,v:.3,d:.06,p:.8,t:0}],[{w:"square",f:260,v:.3,d:.06,p:.8,t:0}],[{w:"sine",f:850,v:.5,d:.07,t:0}],[{w:"sine",f:790,v:.5,d:.07,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"triangle",f:1800,v:.4,p:.9,t:0,h:.03}],[{w:"triangle",f:1800,v:.3,p:.9,t:0,h:.13}],[{w:"n0",f:330,v:.3,a:.02,t:0,r:.01}],[{w:"n0",f:330,v:.3,a:.02,t:0,h:.04,r:.01}],[{w:"n0",f:440,v:.3,t:0}],[{w:"sine",f:800,t:0}],[{w:"sine",f:700,t:0}],[{w:"n0",f:330,v:.3,t:0}],[{w:"n0",f:330,v:.3,t:0,h:.1,r:.01,p:.7}],[{w:"sine",t:0,f:1200,v:.3,r:.01}],[{w:"sine",t:0,f:1200,v:.3,d:.2,r:.2}]],_guiInit:function(){if(this.canvas){this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle="#000";this.ctx.fillRect(0,0,300,32);this.canvas.addEventListener("dragover",this.dragOver.bind(this),false);this.canvas.addEventListener("dragleave",this.dragLeave.bind(this),false);this.canvas.addEventListener("drop",this.execDrop.bind(this),false);this.canvas.addEventListener("click",this.click.bind(this),false);this.canvas.addEventListener("mousedown",this.pointerdown.bind(this),false);this.canvas.addEventListener("mousemove",this.pointermove.bind(this),false);this.canvas.addEventListener("touchstart",this.pointerdown.bind(this),false);this.canvas.addEventListener("touchend",this.pointerup.bind(this),false);this.canvas.addEventListener("touchcancel",this.pointerup.bind(this),false);this.canvas.addEventListener("touchmove",this.pointermove.bind(this),false)}},_guiUpdate:function(){if(this.canvas){this.ctx.fillStyle="#000";this.ctx.fillRect(0,0,300,32);var e=8,s=20;if(this.song)e=4,s=24;else{this.ctx.fillStyle="#fff";this.ctx.fillText("TinySynth",8,20)}if(this.graph){this.ctx.fillStyle="#800";this.ctx.fillRect(80,e,132,4);this.ctx.fillRect(80,s,132,4);this.ctx.fillStyle="#f00";for(let t=this.notetab.length-1;t>=0;--t){const i=this.notetab[t];if(!i.f||this.rhythm[i.ch]){this.ctx.fillRect(80+i.n,e,4,4);this.ctx.fillRect(80+i.ch*8,s,6,4)}}}if(this.perfmon){this.ctx.fillStyle="#fff";this.ctx.fillRect(180,30,28,-12);this.ctx.fillStyle="#000";this.ctx.fillText(this.notetab.length,185,28)}this.ctx.fillStyle="#fff";this.ctx.fillRect(250,15,32,2);this.ctx.fillStyle="#fff";this.ctx.strokeStyle="#000";this.ctx.beginPath();this.ctx.arc(250+this.masterVol*32,16,6,0,6.28,0);this.ctx.moveTo(220,12);this.ctx.lineTo(224,12);this.ctx.lineTo(230,6);this.ctx.lineTo(230,26);this.ctx.lineTo(224,20);this.ctx.lineTo(220,20);this.ctx.fill();this.ctx.stroke();this.ctx.strokeStyle="#fff";this.ctx.lineWidth=2;this.ctx.beginPath();this.ctx.arc(230,16,4,-1,1,false);this.ctx.stroke();this.ctx.beginPath();this.ctx.arc(230,16,8,-1,1,false);this.ctx.stroke();if(this.masterVol==0){this.ctx.strokeStyle="#000";this.ctx.lineWidth=4;this.ctx.beginPath();this.ctx.moveTo(220,7);this.ctx.lineTo(238,25);this.ctx.stroke();this.ctx.strokeStyle="#fff";this.ctx.lineWidth=2;this.ctx.stroke()}if(this.song){this.ctx.fillStyle="#fff";this.ctx.fillRect(4,2,28,28);this.ctx.fillRect(80,15,128,2);this.ctx.fillStyle="#000";if(this.playing){this.ctx.fillRect(12,10,4,12);this.ctx.fillRect(22,10,4,12)}else{this.ctx.beginPath();this.ctx.moveTo(12,9);this.ctx.lineTo(25,16);this.ctx.lineTo(12,23);this.ctx.fill()}this.ctx.fillStyle="#fff";this.ctx.fillText(this.toTime(this.playTick),38,14);this.ctx.fillText(this.toTime(this.maxTick),38,28);this.ctx.strokeStyle="#000";this.ctx.beginPath();this.ctx.arc(80+this.playTick/this.maxTick*128,16,6,0,6.28,0);this.ctx.fill();this.ctx.stroke()}if(this.waitdrop){this.ctx.fillStyle="rgba(0,0,0,0.7)";this.ctx.fillRect(0,0,300,32);this.ctx.fillStyle="#fff";this.ctx.fillText("Drop MIDI File Here",100,20)}}},toTime:function(t){t=t*4*60/this.song.timebase/this.song.tempo|0;const e=t/60|0;const s=t%60;return("00"+e).substr(-2)+":"+("00"+s).substr(-2)},preventScroll:function(t){t.preventDefault()},pointerup:function(t){document.body.removeEventListener("touchstart",this.preventScroll,false)},getPos:function(t){var e=t.target.getBoundingClientRect();if(e.right!=e.left)return{x:(t.clientX-e.left)*300/(e.right-e.left),y:t.clientY-e.top};return{x:0,y:0}},pointerdown:function(t){let e=t;if(t.touches)e=t.touches[0];this.downpos=this.getPos(e);if(t.touches||e.buttons&1){if(this.song&&this.downpos.x>=80&&this.downpos.x<=208){const s=(this.downpos.x-80)/128*this.maxTick;this.locateMIDI(s);document.body.addEventListener("touchstart",this.preventScroll,false)}if(this.downpos.x>=250&&this.downpos.x<282){const s=(this.downpos.x-250)/32;this.setMasterVol(s);document.body.addEventListener("touchstart",this.preventScroll,false)}}},pointermove:function(t){let e=t;if(t.touches)e=t.touches[0];if(t.touches||e.buttons&1){const s=this.getPos(e);if(this.song&&s.x>=70&&s.x<=208){if(s.x<80)s.x=80;const i=(s.x-80)/128*this.maxTick;this.locateMIDI(i)}if(s.x>=250&&s.x<282){const i=(s.x-250)/32;this.setMasterVol(i)}}},click:function(t){const e=this.getPos(t);if(e.x<40&&this.song){if(this.playing)this.stopMIDI();else if(this.song)this.playMIDI()}if(e.x>=215&&e.x<243&&this.downpos.x>=215&&this.downpos.x<243){if(this.masterVol>0){this.lastMasterVol=this.masterVol;this.masterVol=0}else this.masterVol=this.lastMasterVol}},dragLeave:function(t){this.waitdrop=0},dragOver:function(t){this.waitdrop=1;t.stopPropagation();t.preventDefault();t.dataTransfer.dropEffect="copy"},execDrop:function(t){this.waitdrop=0;const e=t.dataTransfer.files;if(this.disabledrop==0){var s=new FileReader;s.onload=function(t){this.loadMIDI(s.result)}.bind(this);s.readAsArrayBuffer(e[0])}t.stopPropagation();t.preventDefault()},ready:function(){return new Promise(function(t){const e=setInterval(function(){if(this.isReady){clearInterval(e);if(this.debug)console.log("Initialized.");t()}},100)})},init:function(){this.pg=[];this.vol=[];this.ex=[];this.bend=[];this.rpnidx=[];this.brange=[];this.sustain=[];this.notetab=[];this.rhythm=[];this.masterTuningC=0;this.masterTuningF=0;this.tuningC=[];this.tuningF=[];this.scaleTuning=[];this.maxTick=0,this.playTick=0,this.playing=0;this.releaseRatio=3.5;for(let t=0;t<16;++t){this.pg[t]=0;this.vol[t]=3*100*100/(127*127);this.bend[t]=0;this.brange[t]=256;this.tuningC[t]=0;this.tuningF[t]=0;this.scaleTuning[t]=[0,0,0,0,0,0,0,0,0,0,0,0];this.rhythm[t]=0}this.rhythm[9]=1;this.preroll=.2;this.relcnt=0;setInterval(function(){if(++this.relcnt>=3){this.relcnt=0;for(let t=this.notetab.length-1;t>=0;--t){var e=this.notetab[t];if(this.actx.currentTime>e.e){this._pruneNote(e);this.notetab.splice(t,1)}}}if(this.playing&&this.song.ev.length>0){let t=this.song.ev[this.playIndex];while(this.actx.currentTime+this.preroll>this.playTime){if(t.m[0]==65361){this.song.tempo=t.m[1];this.tick2Time=4*60/this.song.tempo/this.song.timebase}else this.send(t.m,this.playTime);++this.playIndex;if(this.playIndex>=this.song.ev.length){if(this.loop){t=this.song.ev[this.playIndex=0];this.playTick=t.t}else{this.playTick=this.maxTick;this.playing=0;break}}else{t=this.song.ev[this.playIndex];this.playTime+=(t.t-this.playTick)*this.tick2Time;this.playTick=t.t}}}}.bind(this),60);if(this.debug)console.log("internalcontext:"+this.internalcontext);if(this.internalcontext){e.AudioContext=e.AudioContext||e.webkitAudioContext;this.setAudioContext(new AudioContext)}this.isReady=1},setMasterVol:function(t){if(t!=undefined)this.masterVol=t;if(this.out)this.out.gain.value=this.masterVol},setReverbLev:function(t){if(t!=undefined)this.reverbLev=t;var e=parseFloat(this.reverbLev);if(this.rev&&!isNaN(e))this.rev.gain.value=e*8},setLoop:function(t){this.loop=t},setVoices:function(t){this.voices=t},getPlayStatus:function(){return{play:this.playing,maxTick:this.maxTick,curTick:this.playTick}},locateMIDI:function(t){let e,s=this.playing;this.stopMIDI();for(e=0;e<this.song.ev.length&&t>this.song.ev[e].t;++e){var i=this.song.ev[e];var a=i.m[0]&15;switch(i.m[0]&240){case 176:switch(i.m[1]){case 1:this.setModulation(a,i.m[2]);break;case 7:this.setChVol(a,i.m[2]);break;case 10:this.setPan(a,i.m[2]);break;case 11:this.setExpression(a,i.m[2]);break;case 64:this.setSustain(a,i.m[2]);break}break;case 192:this.pg[i.m[0]&15]=i.m[1];break}if(i.m[0]==65361)this.song.tempo=i.m[1]}if(!this.song.ev[e]){this.playIndex=0;this.playTick=this.maxTick}else{this.playIndex=e;this.playTick=this.song.ev[e].t}if(s)this.playMIDI()},getTimbreName:function(t,e){if(t==0)return this.program[e].name;else return this.drummap[e-35].name},loadMIDIfromSrc:function(){this.loadMIDIUrl(this.src)},loadMIDIUrl:function(t){if(!t)return;var e=new XMLHttpRequest;e.open("GET",t,true);e.responseType="arraybuffer";e.loadMIDI=this.loadMIDI.bind(this);e.onload=function(t){if(this.status==200){this.loadMIDI(this.response)}};e.send()},reset:function(){for(let t=0;t<16;++t){this.setProgram(t,0);this.setBendRange(t,256);this.setModulation(t,0);this.setChVol(t,100);this.setPan(t,64);this.resetAllControllers(t);this.allSoundOff(t);this.rhythm[t]=0;this.tuningC[t]=0;this.tuningF[t]=0}this.masterTuningC=0;this.masterTuningF=0;this.rhythm[9]=1},stopMIDI:function(){this.playing=0;for(var t=0;t<16;++t)this.allSoundOff(t)},playMIDI:function(){if(!this.song)return;const t=this.actx.createOscillator();t.connect(this.actx.destination);t.frequency.value=0;t.start(0);t.stop(this.actx.currentTime+.001);if(this.playTick>=this.maxTick)this.playTick=0,this.playIndex=0;this.playTime=this.actx.currentTime+.1;this.tick2Time=4*60/this.song.tempo/this.song.timebase;this.playing=1},loadMIDI:function(t){function e(t,e){return(t[e]<<8)+t[e+1]}function o(t,e){return(t[e]<<16)+(t[e+1]<<8)+t[e+2]}function s(t,e){return(t[e]<<24)+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3]}function l(t,e,s){return String.fromCharCode.apply(null,t.slice(e,e+s))}function d(t,e){var s,i;s=0;v=1;while((i=t[e])&128){s=(s<<7)+(i&127);++v;++e}return(s<<7)+i}function i(t,e,s,i){var a=s[i];v=1;if((a&128)==0)a=w,v=0;w=a;switch(a&240){case 192:case 208:t.ev.push({t:e,m:[a,s[i+v]]});v+=1;break;case 240:switch(a){case 240:case 247:var n=d(s,i+1);c=1+v;var r=Array.from(s.slice(i+c,i+c+n));r.unshift(240);t.ev.push({t:e,m:r});v+=n+1;break;case 255:var n=d(s,i+2);c=2+v;v=n+v+2;switch(s[i+1]){case 2:t.copyright+=l(s,i+c,v-3);break;case 1:case 3:case 4:case 9:t.text=l(s,i+c,v-c);break;case 47:return 1;case 81:var h=Math.floor(6e7/o(s,i+3));t.ev.push({t:e,m:[65361,h]});break}break}break;default:t.ev.push({t:e,m:[a,s[i+v],s[i+v+1]]});v+=2}return 0}this.stopMIDI();var a=new Uint8Array(t);var v=0,c=0,w=144;var n=0;var r=a.slice(0,4);if(r.toString()!="77,84,104,100")return;var h=s(a,4);var f=e(a,8);var u=e(a,10);this.maxTick=0;var g=e(a,12)*4;n=h+8;this.song={copyright:"",text:"",tempo:120,timebase:g,ev:[]};for(let t=0;t<u;++t){r=a.slice(n,n+4);h=s(a,n+4);if(r.toString()=="77,84,114,107"){var m=0;var p=0;this.notetab.length=0;for(;;){m+=d(a,n+8+p);p+=v;var b=i(this.song,m,a,n+8+p);p+=v;if(b)break}if(m>this.maxTick)this.maxTick=m}n+=h+8}this.song.ev.sort(function(t,e){return t.t-e.t});this.reset();this.locateMIDI(0)},setQuality:function(t){if(t!=undefined)this.quality=t;for(let t=0;t<128;++t)this.setTimbre(0,t,this.program0[t]);for(let t=0;t<this.drummap0.length;++t)this.setTimbre(1,t+35,this.drummap0[t]);if(this.quality){for(let t=0;t<this.program1.length;++t)this.setTimbre(0,t,this.program1[t]);for(let t=0;t<this.drummap.length;++t){if(this.drummap1[t])this.setTimbre(1,t+35,this.drummap1[t])}}},setTimbre:function(t,s,e){const i={g:0,w:"sine",t:1,f:0,v:.5,a:0,h:.01,d:.01,s:0,r:.05,p:1,q:1,k:0};function a(e){for(s=0;s<e.length;++s){for(let t in i){if(!e[s].hasOwnProperty(t)||typeof e[s][t]=="undefined")e[s][t]=i[t]}}return e}if(t&&s>=35&&s<=81)this.drummap[s-35].p=a(e);if(t==0&&s>=0&&s<=127)this.program[s].p=a(e)},_pruneNote:function(e){for(let t=e.o.length-1;t>=0;--t){if(e.o[t].frequency){e.o[t].frequency.cancelScheduledValues(0)}else{e.o[t].playbackRate.cancelScheduledValues(0)}e.g[t].gain.cancelScheduledValues(0);e.o[t].stop();if(e.o[t].detune){try{this.chmod[e.ch].disconnect(e.o[t].detune)}catch(t){}}e.g[t].gain.value=0}},_limitVoices:function(t,e){this.notetab.sort(function(t,e){if(t.f!=e.f)return t.f-e.f;if(t.e!=e.e)return e.e-t.e;return e.t-t.t});for(let t=this.notetab.length-1;t>=0;--t){var s=this.notetab[t];if(this.actx.currentTime>s.e||t>=this.voices-1){this._pruneNote(s);this.notetab.splice(t,1)}}},_note:function(e,s,i,a,n){let r,h,o;const l=[],d=[],v=[],c=[],w=[];const f=440*Math.pow(2,(i-69+this.masterTuningC+this.tuningC[s]+(this.masterTuningF+this.tuningF[s]/8192+this.scaleTuning[s][i%12]))/12);this._limitVoices(s,i);for(let t=0;t<n.length;++t){o=n[t];const u=e+o.a+o.h;if(o.g==0)r=this.chvol[s],h=a*a/16384,c[t]=f*o.t+o.f;else if(o.g>10)r=d[o.g-11].gain,h=1,c[t]=c[o.g-11]*o.t+o.f;else if(l[o.g-1].frequency)r=l[o.g-1].frequency,h=c[o.g-1],c[t]=c[o.g-1]*o.t+o.f;else r=l[o.g-1].playbackRate,h=c[o.g-1]/440,c[t]=c[o.g-1]*o.t+o.f;switch(o.w[0]){case"n":l[t]=this.actx.createBufferSource();l[t].buffer=this.noiseBuf[o.w];l[t].loop=true;l[t].playbackRate.value=c[t]/440;if(o.p!=1)this._setParamTarget(l[t].playbackRate,c[t]/440*o.p,e,o.q);if(l[t].detune){this.chmod[s].connect(l[t].detune);l[t].detune.value=this.bend[s]}break;default:l[t]=this.actx.createOscillator();l[t].frequency.value=c[t];if(o.p!=1)this._setParamTarget(l[t].frequency,c[t]*o.p,e,o.q);if(o.w[0]=="w")l[t].setPeriodicWave(this.wave[o.w]);else l[t].type=o.w;if(l[t].detune){this.chmod[s].connect(l[t].detune);l[t].detune.value=this.bend[s]}break}d[t]=this.actx.createGain();w[t]=o.r;l[t].connect(d[t]);d[t].connect(r);v[t]=h*o.v;if(o.k)v[t]*=Math.pow(2,(i-60)/12*o.k);if(o.a){d[t].gain.value=0;d[t].gain.setValueAtTime(0,e);d[t].gain.linearRampToValueAtTime(v[t],e+o.a)}else d[t].gain.setValueAtTime(v[t],e);this._setParamTarget(d[t].gain,o.s*v[t],u,o.d);l[t].start(e);if(this.rhythm[s]){l[t].onended=function(){try{if(l[t].detune)this.chmod[s].disconnect(l[t].detune)}catch(t){}};l[t].stop(e+n[0].d*this.releaseRatio)}}if(!this.rhythm[s])this.notetab.push({t:e,e:99999,ch:s,n:i,o:l,g:d,t2:e+o.a,v:v,r:w,f:0})},_setParamTarget:function(t,e,s,i){if(i!=0)t.setTargetAtTime(e,s,i);else t.setValueAtTime(e,s)},_releaseNote:function(e,s){if(e.ch!=9){for(let t=e.g.length-1;t>=0;--t){e.g[t].gain.cancelScheduledValues(s);if(s==e.t2)e.g[t].gain.setValueAtTime(e.v[t],s);else if(s<e.t2)e.g[t].gain.setValueAtTime(e.v[t]*(s-e.t)/(e.t2-e.t),s);this._setParamTarget(e.g[t].gain,0,s,e.r[t])}}e.e=s+e.r[0]*this.releaseRatio;e.f=1},setModulation:function(t,e,s){this.chmod[t].gain.setValueAtTime(e*100/127,this._tsConv(s))},setChVol:function(t,e,s){this.vol[t]=3*e*e/(127*127);this.chvol[t].gain.setValueAtTime(this.vol[t]*this.ex[t],this._tsConv(s))},setPan:function(t,e,s){if(this.chpan[t])this.chpan[t].pan.setValueAtTime((e-64)/64,this._tsConv(s))},setExpression:function(t,e,s){this.ex[t]=e*e/(127*127);this.chvol[t].gain.setValueAtTime(this.vol[t]*this.ex[t],this._tsConv(s))},setSustain:function(e,t,s){this.sustain[e]=t;s=this._tsConv(s);if(t<64){for(let t=this.notetab.length-1;t>=0;--t){const i=this.notetab[t];if(s>=i.t&&i.ch==e&&i.f==1)this._releaseNote(i,s)}}},allSoundOff:function(e){for(let t=this.notetab.length-1;t>=0;--t){const s=this.notetab[t];if(s.ch==e){this._pruneNote(s);this.notetab.splice(t,1)}}},resetAllControllers:function(t){this.bend[t]=0;this.ex[t]=1;this.rpnidx[t]=16383;this.sustain[t]=0;if(this.chvol[t]){this.chvol[t].gain.value=this.vol[t]*this.ex[t];this.chmod[t].gain.value=0}},setBendRange:function(t,e){this.brange[t]=e},setProgram:function(t,e){if(this.debug)console.log("Pg("+t+")="+e);this.pg[t]=e},_tsConv:function(t){if(t==undefined||t<=0){t=0;if(this.actx)t=this.actx.currentTime}else{if(this.tsmode)t=t*.001-this.tsdiff}return t},setBend:function(e,t,s){s=this._tsConv(s);const i=this.brange[e]*100/127;this.bend[e]=(t-8192)*i/8192;for(let t=this.notetab.length-1;t>=0;--t){const a=this.notetab[t];if(a.ch==e){for(let t=a.o.length-1;t>=0;--t){if(a.o[t].frequency)if(a.o[t].detune)a.o[t].detune.setValueAtTime(this.bend[e],s)}}}},noteOff:function(e,s,i){if(this.rhythm[e])return;i=this._tsConv(i);for(let t=this.notetab.length-1;t>=0;--t){const a=this.notetab[t];if(i>=a.t&&a.ch==e&&a.n==s&&a.f==0){a.f=1;if(this.sustain[e]<64)this._releaseNote(a,i)}}},noteOn:function(t,e,s,i){if(s==0){this.noteOff(t,e,i);return}i=this._tsConv(i);if(this.rhythm[t]){if(e>=35&&e<=81)this._note(i,t,e,s,this.drummap[e-35].p);return}this._note(i,t,e,s,this.program[this.pg[t]].p)},setTsMode:function(t){this.tsmode=t},send:function(e,t){const s=e[0]&15;const i=e[0]&~15;if(i<128||i>=256)return;if(this.audioContext.state=="suspended"){this.audioContext.resume()}switch(i){case 176:switch(e[1]){case 1:this.setModulation(s,e[2],t);break;case 7:this.setChVol(s,e[2],t);break;case 10:this.setPan(s,e[2],t);break;case 11:this.setExpression(s,e[2],t);break;case 64:this.setSustain(s,e[2],t);break;case 98:case 99:this.rpnidx[s]=16383;break;case 100:this.rpnidx[s]=this.rpnidx[s]&16256|e[2];break;case 101:this.rpnidx[s]=this.rpnidx[s]&127|e[2]<<7;break;case 6:switch(this.rpnidx[s]){case 0:this.brange[s]=(e[2]<<7)+(this.brange[s]&127);break;case 1:this.tuningF[s]=(e[2]<<7)+(this.tuningF[s]+8192&127)-8192;break;case 2:this.tuningC[s]=e[2]-64;break}break;case 38:switch(this.rpnidx[s]){case 0:this.brange[s]=this.brange[s]&16256|e[2];break;case 1:this.tuningF[s]=(this.tuningF[s]+8192&16256|e[2])-8192;break;case 2:break}break;case 120:case 123:case 124:case 125:case 126:case 127:this.allSoundOff(s);break;case 121:this.resetAllControllers(s);break}break;case 192:this.setProgram(s,e[1]);break;case 224:this.setBend(s,e[1]+(e[2]<<7),t);break;case 144:this.noteOn(s,e[1],e[2],t);break;case 128:this.noteOff(s,e[1],t);break;case 240:if(e[0]==255){this.reset();break}if(e[0]!=254&&this.debug){var a=[];for(let t=0;t<e.length;++t)a.push(e[t].toString(16))}if(e[0]==240){if(e[1]==127&&e[3]==4){if(e[4]==3&&e.length>=8){this.masterTuningF=(e[6]*128+e[5]-8192)/8192}if(e[4]==4&&e.length>=8){this.masterTuningC=e[6]-64}}if(e[1]==65&&e[3]==66&&e[4]==18&&e[5]==64){if((e[6]&240)==16&&e.length==11){const n=[9,0,1,2,3,4,5,6,7,8,10,11,12,13,14,15][e[6]&15];if(e[7]==21){this.rhythm[n]=e[8]}else if(e[7]>=64&&e[7]<=75){this.scaleTuning[n][e[7]-64]=(e[8]-64)/100}}else if(e[6]==0){if(e[7]==0&&e.length==14){this.masterTuningF=(e[8]*4096+e[9]*256+e[10]*16+e[11]-1024)/1e3}else if(e[7]==5&&e.length==11){this.masterTuningC=e[8]-64}}}}break}},_createWave:function(e){const s=new Float32Array(e.length);const t=new Float32Array(e.length);for(let t=1;t<e.length;++t)s[t]=e[t];return this.actx.createPeriodicWave(t,s)},getAudioContext:function(){return this.actx},setAudioContext:function(t,e){this.audioContext=this.actx=t;this.dest=e;if(!e)this.dest=t.destination;this.tsdiff=performance.now()*.001-this.actx.currentTime;if(this.debug)console.log("TSDiff:"+this.tsdiff);this.out=this.actx.createGain();this.comp=this.actx.createDynamicsCompressor();var s=this.actx.sampleRate*.5|0;this.convBuf=this.actx.createBuffer(2,s,this.actx.sampleRate);this.noiseBuf={};this.noiseBuf.n0=this.actx.createBuffer(1,s,this.actx.sampleRate);this.noiseBuf.n1=this.actx.createBuffer(1,s,this.actx.sampleRate);var i=this.convBuf.getChannelData(0);var a=this.convBuf.getChannelData(1);var n=this.noiseBuf.n0.getChannelData(0);var r=this.noiseBuf.n1.getChannelData(0);for(let t=0;t<s;++t){if(t/s<Math.random()){i[t]=Math.exp(-3*t/s)*(Math.random()-.5)*.5;a[t]=Math.exp(-3*t/s)*(Math.random()-.5)*.5}n[t]=Math.random()*2-1}for(let t=0;t<64;++t){const o=Math.random()*10+1;const l=Math.random()*10+1;for(let t=0;t<s;++t){var h=Math.sin(t/s*2*Math.PI*440*o)*Math.sin(t/s*2*Math.PI*440*l);r[t]+=h/8}}if(this.useReverb){this.conv=this.actx.createConvolver();this.conv.buffer=this.convBuf;this.rev=this.actx.createGain();this.rev.gain.value=this.reverbLev;this.out.connect(this.conv);this.conv.connect(this.rev);this.rev.connect(this.comp)}this.setMasterVol();this.out.connect(this.comp);this.comp.connect(this.dest);this.chvol=[];this.chmod=[];this.chpan=[];this.wave={w9999:this._createWave("w9999")};this.lfo=this.actx.createOscillator();this.lfo.frequency.value=5;this.lfo.start(0);for(let t=0;t<16;++t){this.chvol[t]=this.actx.createGain();if(this.actx.createStereoPanner){this.chpan[t]=this.actx.createStereoPanner();this.chvol[t].connect(this.chpan[t]);this.chpan[t].connect(this.out)}else{this.chpan[t]=null;this.chvol[t].connect(this.out)}this.chmod[t]=this.actx.createGain();this.lfo.connect(this.chmod[t]);this.pg[t]=0;this.resetAllControllers(t)}this.setReverbLev();this.reset();this.send([144,60,1]);this.send([144,60,0])}})}if(e&&document.attachEvent&&!e.customElements){function s(){HTMLElement.call(this);this.init()}s.prototype=Object.create(HTMLElement.prototype);s.prototype.constructor=s;s.prototype.init=function(){var t=document.createElement("div");t.innerHTML="<canvas"+" id='wa-canvas' width='300' height='32'"+" touch-action='none' tabindex='0'"+" style='"+" position:relative;"+" margin:0;"+" border:none;"+" width:300px;"+" height:32px;"+"'>"+"</canvas>"+"<div id='wa-logo'"+" style='"+" display:none;"+" position:absolute;"+" top:5px;"+" left:5px;"+" color:#fff;"+" font-size:8px;"+" background:rgba(0,0,0,0.5);"+"'>"+"TinySynth</div>";var i=this;this.getAttr=function(t,e){var s=i.getAttribute(t);if(s===""||s==null)return e;switch(typeof e){case"number":if(s==="true")return 1;s=+s;if(isNaN(s))return 0;return s}return s};this.canvas=t.children[0];this.appendChild(t);n.call(this);var e=this.properties||{};for(var s in e){if(e.hasOwnProperty(s)){var a=e[s];if(a.observer){this["_"+s]=a.value;(function(e,s){Object.defineProperty(i,e,{get:function(){return i["_"+e]},set:function(t){i["_"+e]=t;i[s]()}})})(s,a.observer)}else{this[s]=a}}}for(var s in e){if(e.hasOwnProperty(s)){var a=e[s];this[s]=this.getAttr(s,a.value)}}this.setQuality(1);this.init();this._guiInit();setInterval(this._guiUpdate.bind(this),100)};document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){var t=document.getElementsByTagName("webaudio-tinysynth");for(var e=0;e<t.length;e++){s.call(t[e])}}})}function t(t){n.call(this,this);for(var e in this.properties){if(this.properties.hasOwnProperty(e)){this[e]=this.properties[e].value}}this.setQuality(1);if(t){if(t.useReverb!==undefined){this.useReverb=t.useReverb}if(t.quality!==undefined){this.setQuality(t.quality)}if(t.voices!==undefined){this.setVoices(t.voices)}}this.init()}if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t}else if(typeof define==="function"&&define.amd){define(function(){return t})}else{e.WebAudioTinySynth=t;e.WebAudioTinySynthCore=n}})(this);