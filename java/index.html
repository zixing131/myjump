<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>j2me在线模拟器</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
		 
		<!-- Required for non-UTF encodings -->
		<script src="libs/encoding.js"></script>
		<!-- Load config scripts separately because compiled-method-cache.js
     - depends on them. -->
		<script type="text/javascript" src="config/default.js" defer></script>
		<script type="text/javascript" src="config/runtests.js" defer></script>
		<script type="text/javascript" src="config/build.js" defer></script>
		<script type="text/javascript" src="config/urlparams.js" defer></script>


		<!--<script type="text/javascript" src="libs/terminal.js" defer></script>-->

		<!-- Load promise-6.0.0.js and IndexedDB-getAll-shim.js separately
     - because compiled-method-cache.js depends on them. -->
		<script type="text/javascript" src="libs/promise-6.0.0.js" defer></script>
		<script type="text/javascript" src="polyfill/IndexedDB-getAll-shim.js" defer></script>

		<!-- Load compiled-method-cache.js separately because j2me.js depends on it. -->
		<script type="text/javascript" src="libs/compiled-method-cache.js" defer></script>

		<!-- Load bld/native.js separately because adding it to main-all.js
     - throws an "asm.js type error". -->
		<script type="text/javascript" src="bld/native.js" defer></script>

		<!-- Load j2me.js separately because classes.jar.js depends on it (it adds
     - members to the AOTMD hash that j2me.js defines); and also so its source
     - map gets loaded by the debugger. -->
		<script type="text/javascript" src="bld/j2me.js" defer></script>

		<!-- Run `make aot` to generate these.  Load them separately, because adding
     - classes.jar.js to main-all.js fails silently for unknown reasons. -->
		<!--<script type="text/javascript" src="bld/classes.jar.js" defer></script>-->
		<!--<script type="text/javascript" src="bld/program.jar.js" defer></script>-->
		<!--<script type="text/javascript" src="bld/tests.jar.js" defer></script>-->

		<!-- Load the rest of the scripts from the combined script main-all.js
     - to improve startup and runtime performance.  See Makefile for the list
     - of files that get combined into this one. -->
		<script type="text/javascript" src="bld/main-all.js" defer></script>

	</head>
	<body> 
		<input id="jarFileupload" accept=".jar" type="file" style="visibility: hidden;display:none;" />
		
		<p> <a href="/" style="font-weight: bold"><h3> 回到主页 </h3></a></p>

		<h3>游戏列表：</h3>
		<div id="gameListDiv"
			style="display:flex;flex-wrap: wrap; margin-bottom: 10px; float:left;align-items: center;">

			<script type="text/javascript">
				var GameList = [{
						name: "Anyview",
						jarName: "Anyview4.0.jar",
						picPath: "img/anyview.png"
					},
					{
						name: "狂野飙车6",
						jarName: "kybc6.jar",
						picPath: "img/kybc6.png"
					},
					{
						name: "植物大战僵尸",
						jarName: "pvz.jar",
						picPath: "img/pvz.png"
					},
					{
						name: "刺客信条3",
						jarName: "ckxt3.jar",
						picPath: "img/ckxt3.png"
					},
					{
						name: "开心农场",
						jarName: "kxnc.jar",
						picPath: "img/kxnc.png"
					},
					{
						name: "RF18",
						jarName: "rf18.jar",
						picPath: "img/rf18.png"
					},
					{
						name: "BounceTales",
						jarName: "BounceTales.jar",
						picPath: "img/BounceTales.png"
					},
					{
						name: "极限拉力赛2",
						jarName: "jxlls.jar",
						picPath: "img/jxlls.png"
					},
					{
						name: "斗地主",
						jarName: "ddz.jar",
						picPath: "img/ddz.png"
					},
					{
						name: "GTA5",
						jarName: "gta.jar",
						picPath: "img/gta.png"
					},
					{
						name: "涂鸦跳跃",
						jarName: "tyty.jar",
						picPath: "img/tyty.png"
					},{
						name: "中国象棋",
						jarName: "chess.jar",
						picPath: "img/chess.png"
					},
					{
						name: "模拟人生3",
						jarName: "sim3.jar",
						picPath: "img/sim3.png"
					},
					{
						name: "韩版开心农场",
						jarName: "kxnckr.jar",
						picPath: "img/kxnckr.png"
					},
					{
						name: "侏罗纪公园-巨兽归来",
						jarName: "dragon.jar",
						picPath: "img/dragon.png"
					},
					{
						name: "鳄鱼小顽皮爱洗澡",
						jarName: "WheresMyWater.jar",
						picPath: "img/WheresMyWater.png"
					},
					{
						name: "实况足球2020",
						jarName: "skzq.jar",
						picPath: "img/skzq.png"
					},
					{
						name: "QQ2010触屏版",
						jarName: "QQ2010_touch.jar",
						picPath: "img/QQ2010_touch.png"
					},{
						name: "时光樱花册-遗失之心",
						jarName: "sgyhc.jar",
						picPath: "img/sgyhc.png"
					}, 
					{
						name: "钻石狂潮",
						jarName: "zskc.jar",
						picPath: "img/zskc.png"
					},
					{
						name: "不可思议的机器",
						jarName: "machine.jar",
						picPath: "img/machine.png"
					} 
					,
					{
						name: "刺客信条兄弟会触屏版",
						jarName: "acb.jar",
						picPath: "img/acb.png"
					},
					{
						name: "刺客信条大屏触屏版",
						jarName: "asbr.jar",
						picPath: "img/asbr.png"
					},
					{
						name: "刺客信条3大屏触屏版",
						jarName: "ckxt3big.jar",
						picPath: "img/ckxt3big.png"
					},
					{
						name: "文明V键盘版",
						jarName: "c5small.jar",
						picPath: "img/c5small.png"
					},
					{
						name: "文明V触屏大屏版",
						jarName: "c5big.jar",
						picPath: "img/c5big.png"
					},
					{
						name: "极品飞车13-变速中文",
						jarName: "nfs13.jar",
						picPath: "img/nfs13.png"
					}
				]
				// 初始化游戏列表
				var GameListHtml = '';
				for (var i = 0; i < GameList.length; i++) {
					var gameName = GameList[i]['name'];
					var jarName = GameList[i]['jarName'];
					var midletClassName = GameList[i]['midletClassName'];
					var picPath = GameList[i]['picPath'];
					var onClickFunc = "openJar('"+jarName+"','"+midletClassName+"');";
					GameListHtml += '<a class="game" href="javascript:void(0)" onclick="'+onClickFunc+'">' +
						'<div>' +
						'<img src="' + picPath + '" width="64px" height="64px" style="margin-top:4px"></img>' +
						'</div>' +
						'<span style="font-size:12px">' + gameName + '</span>' +
						'</a>';
				}
				document.getElementById('gameListDiv').innerHTML = GameListHtml;


				function refreshGameList() {
					JARStore.getAll().then(
						function(files){
							var localjars = document.getElementById('localjars');
							localjars.length = 0;
							for (var i = 0; i < files.length; i++) {
								var f = files[i];
								//console.log(f.jarName);
								//JARStore.loadJAR(f.jarName);
								localjars.options.add(new Option(f.jarName));
							}
							var gameindex = config01.getValueByKey("gameindex");
							var localjars = document.getElementById('localjars');
							if (gameindex >= files.length) {
								gameindex = files.length - 1;
							}
							localjars.selectedIndex = gameindex;
						},
						function(err){
							alert(err);
						}
					);
				}

				function loadLocalJar() {
					
					var localjars = document.getElementById('localjars');
					if (localjars.options.length == 0) {
						alert("请先上传jar!");
						return;
					}
					if (localjars.selectedIndex < 0 || localjars.selectedIndex >= localjars.options.length) {
						alert("请选择jar名称!");
						return;
					}
					var jarname = localjars.options[localjars.selectedIndex].text;
					console.log(jarname);
					openJar(jarname, "", 1);

				}


				function deleteLocalJar() {

					var localjars = document.getElementById('localjars');
					if (localjars.options.length == 0) {
						alert("没有要删除的jar!");
						return;
					}
					if (localjars.selectedIndex < 0 || localjars.selectedIndex >= localjars.options.length) {
						alert("请选择jar名称!");
						return;
					}
					var jarname = localjars.options[localjars.selectedIndex].text;
					console.log(jarname);
					let res = confirm('确定删除 ' + jarname + ' ？');
					if (res) {
						JARStore.deleteJar(jarname).then(
							function() {
								alert(jarname + "删除成功！");
								refreshGameList();

							},
							function(errname) {
								alert(errname + "删除失败！");
							}
						);
					}
				}
				var onUploadFile = function(e) {
					const _files = e.target.files;
					if (_files.length == 0) {
						return;
					}
					const _file = _files[0];
					if (!_file.name.toLowerCase().endsWith('.jar')) {
						alert("只能上传jar格式!");
						return;
					}
					//fs.createUniqueFile("/Phone",_file.name,_file);
					const reader = new FileReader();
					reader.readAsArrayBuffer(_file);
					reader.onload = function(readRes) {
						JARStore.installJAR(_file.name, readRes.target.result).then(
							function()  {
								alert(_file.name + "安装成功！");
								refreshGameList();
							},
							function(errname) {
								alert(errname + "安装失败！");
							}
						);
						document.getElementById("jarFileupload").value = null;
					}
				}

				var config = function() {
					var myInfo = {
						canvasSize: 4,
						gamepadSize: 0,
						gameresize: 0,
						gameindex: 0,
					};
					if (window.localStorage["my"] === undefined) {
						window.localStorage["my"] = JSON.stringify(myInfo);
					} else {
						var data = JSON.parse(window.localStorage["my"]);
						for (var key in data) {
							myInfo[key] = data[key];
						}
					}
					
					return { 
						getValueByKey:function(key) {
							return myInfo[key]
						}, 
						setValueByKey:function() {
							for (var i = 0; i < arguments.length; i += 2) {
								myInfo[arguments[i]] = arguments[i + 1];
							} 
							window.localStorage["my"] = JSON.stringify(myInfo);
						}
					}
				}

				var config01 = new config();
				window.addEventListener("load", function() {

					var csize = config01.getValueByKey("canvasSize");
					var gsize = config01.getValueByKey("gamepadSize");
					var gresize = config01.getValueByKey("gameresize");

					var gamepadSize = document.getElementById('gamepadSize');
					var canvasSize = document.getElementById('canvasSize');
					var gameresize = document.getElementById('gameresize');


					canvasSize.selectedIndex = csize;
					gamepadSize.selectedIndex = gsize;
					gameresize.selectedIndex = gresize;

					document.getElementById("jarFileupload").addEventListener("change", onUploadFile);
					refreshGameList();

				})


				function openLocalJar() {
					document.getElementById("jarFileupload").click();
				}

				function openJar(jarname, midletClassName, islocaljar) {
					//var mycheck1=document.getElementById('mycheck1'); 
					//var mycheck2=document.getElementById('mycheck2'); 
					var href = 'main.html?jars=jar/' + jarname + '&jad=&midletClassName=' + midletClassName;
					if (islocaljar) {
						href = 'main.html?localjar=' + jarname;
					}
					//if(mycheck1.checked)
					//{
					//	href+="&gamepad=1";
					//}
					/*
					if(mycheck2.checked)
					{
						href+="&enablexy=1";
					}
					*/
					var gamepadSize = document.getElementById('gamepadSize');
					var mvalue = gamepadSize.options[gamepadSize.selectedIndex].value;
					if (mvalue) {
						href += "&gamepadSize=" + mvalue;
						if (gamepadSize.selectedIndex == 0) {
							href += "&gamepad=0";
						} else {
							href += "&gamepad=1";
						}
					}

					var canvasSize = document.getElementById('canvasSize');
					var mvalue = canvasSize.options[canvasSize.selectedIndex].value;
					if (mvalue) {
						href += "&canvasSize=" + mvalue;
					}
					var gameresize = document.getElementById('gameresize');
					var gameresizevalue = gameresize.options[gameresize.selectedIndex].value;
					if (gameresizevalue) {
						href += "&gameresize=" + gameresizevalue;
					}

					var localjars = document.getElementById('localjars');

					config01.setValueByKey("canvasSize", canvasSize.selectedIndex);
					config01.setValueByKey("gamepadSize", gamepadSize.selectedIndex);
					config01.setValueByKey("gameresize", gameresize.selectedIndex);
					config01.setValueByKey("gameindex", localjars.selectedIndex)

					window.location.href = href;
				}
			</script> 
		</div>

		<!-- <label><input id="mycheck1" name="enablekey" type="checkbox"  checked value="" />启用按键</label> -->
		<!-- <label><input id="mycheck2" name="enablexy" type="checkbox" value="" />自适应缩放</label>  -->
		<div style="margin-top: 100px; clear: both;">

			<select id="canvasSize" class="filter-box">
				<option value="size-240x320">显示尺寸: 240x320</option>
				<option value="size-320x240">显示尺寸: 320x240</option>
				<option value="size-128x128">显示尺寸: 128x128</option>
				<option value="size-176x220">显示尺寸: 176x220</option>
				
				<option value="size-240x400">显示尺寸: 240x400</option>
				<option value="size-400x240">显示尺寸: 400x240</option>
				<option value="size-360x640">显示尺寸: 360x640</option>
				<option value="size-640x360">显示尺寸: 640x360</option>
				<option value="size-400x800">显示尺寸: 400x800</option>
				<option value="size-800x400">显示尺寸: 800x400</option>
				<option value="size-no" selected>显示尺寸: 无限制</option>
			</select>
			<select id="gamepadSize" class="filter-box">
				<option value="gamepad-0" selected>虚拟键盘-无</option>
				<option value="gamepad-1">虚拟键盘-小</option>
				<option value="gamepad-2">虚拟键盘-中</option>
				<option value="gamepad-3">虚拟键盘-大</option>
				<option value="gamepad-4">虚拟键盘-特大</option>
			</select>

			<select id="gameresize" class="filter-box">
				<option value="resize-1" selected>无缩放</option> 
				<option value="resize-0x5">缩放0.5倍</option>
				<option value="resize-0x75">缩放0.75倍</option>
				<option value="resize-1x5">缩放1.5倍</option>
				<option value="resize-2">缩放2倍</option>
				<option value="resize-2x5">缩放2.5倍</option>
				<option value="resize-3">缩放3倍</option>
			</select>
			</br>
			</br>
			<select id="localjars" class="filter-box">
				<option value="" selected>无项目</option>
			</select>
			<button class="btn" onclick="openLocalJar()">
				选择本地jar
			</button>

			<button class="btn" onclick="loadLocalJar()">
				运行本地jar
			</button>

			<button class="btn" onclick="deleteLocalJar()">
				删除本地jar
			</button>

			</br>
			</br>
			</br>
			</br>
			<a href="indexbatch.html" style="float: right;">
				批量安装版本
			</a>
			</br>
			</br>
			<a href="updatelog.html" style="float: right;">
				更新日志
			</a>
			</br>
		</div>

		<style>
			@media screen and (min-width: 1080px) {
				body {
					margin: 0 auto;
					padding-left: 20%;
					padding-right: 20%;
					padding-top: 50px;
				}

				.filter-box {
					width: 240px;
					height: 34px;
					background-color: #ffffff;
					border: solid 1px #dcdcdc;
					font-family: Roboto;
					font-size: 12px;
					font-weight: normal;
					font-style: normal;
					font-stretch: normal;
					letter-spacing: normal;
					text-align: left;
					color: #3d3d3d;
					padding-left: 10px;
					border-color: #dcdcdc;
					-webkit-appearance: none;
				}

				select {
					background-position: 222px 9px;
					font-family: Roboto;
					font-size: 12px;
					color: #3d3d3d;
					background-repeat: no-repeat;
				}

				.game {
					height: 100px;
					width: 80px;
					text-align: center;
					width: 120px;
					height: 100px;
					border: 1px solid silver;
					margin-right: 10px;
					padding: 10px;
					border-radius: 5px;
					text-align: center;
					margin-top: 10px;
				}

				.btn {
					background: #2079b0;
					/* 创建渐变 */
					/* background-image: -webkit-linear-gradient(top, #2079b0, #2079b0);
					background-image: -moz-linear-gradient(top, #2079b0, #2079b0);
					background-image: -ms-linear-gradient(top, #2079b0, #2079b0);
					background-image: -o-linear-gradient(top, #2079b0, #2079b0);
					background-image: linear-gradient(to bottom, #2079b0, #2079b0); */
					/* 给按钮添加圆角 */
					-webkit-border-radius: 8;
					-moz-border-radius: 8;
					border-radius: 8px;
					/* text-shadow: 3px 2px 1px #9daef5; */
					-webkit-box-shadow: 6px 5px 24px #666666;
					-moz-box-shadow: 6px 5px 24px #666666;
					box-shadow: 6px 5px 24px #666666;
					font-family: Arial;
					color: #fafafa;
					font-size: 12px;
					padding: 10px;
					text-decoration: none;
					margin-right: 5px;
				}

				/* 悬停样式 */
				.btn:hover {
					background: #2079b0;
					/* background-image: -webkit-linear-gradient(top, #2079b0, #2079b0);
					background-image: -moz-linear-gradient(top, #2079b0, #2079b0);
					background-image: -ms-linear-gradient(top, #2079b0, #2079b0);
					background-image: -o-linear-gradient(top, #2079b0, #2079b0);
					background-image: linear-gradient(to bottom, #2079b0, #2079b0); */
					text-decoration: none;
				}

				.blink {
					font-size: 46px;
					color: #4cc134;
					margin: 10px;
					animation: changeshadow 1s ease-in infinite;
					/* 其它浏览器兼容性前缀 */
					-webkit-animation: changeshadow 1s linear infinite;
					-moz-animation: changeshadow 1s linear infinite;
					-ms-animation: changeshadow 1s linear infinite;
					-o-animation: changeshadow 1s linear infinite;
				}

				@keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}

				/* 添加兼容性前缀 */
				@-webkit-keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}

				@-moz-keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}

				@-ms-keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}

				@-o-keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}
			}

			@media screen and (min-width: 300px) and (max-width: 1080px) {
				body {
					/* 		margin: 0 auto;
					padding-left: 10%;
					padding-right: 10%;
					padding-top: 10px; */
				}

				#gameListDiv {
					justify-content: center;
				}


				.filter-box {
					width: 100%;
					height: 34px;
					background-color: #ffffff;
					border: solid 1px #dcdcdc;
					font-family: Roboto;
					font-size: 12px;
					font-weight: normal;
					font-style: normal;
					font-stretch: normal;
					letter-spacing: normal;
					text-align: left;
					color: #3d3d3d;
					padding-left: 10px;
					border-color: #dcdcdc;
					margin-top: 5px;
					-webkit-appearance: none;
				}

				select {
					background-position: 222px 9px;
					font-family: Roboto;
					font-size: 12px;
					color: #3d3d3d;
					background-repeat: no-repeat;
				}

				.game {
					height: 80px;
					width: 90px;
					text-align: center;
					border: 1px solid silver;
					margin-right: 15px;
					padding: 10px;
					border-radius: 5px;
					text-align: center;
					margin-top: 10px;
					font-size: 12px;
					padding-bottom: 10px;
				}

				.btn {
					margin-top: 5px;
					background: #2079b0;
					/* 创建渐变 */
					/* background-image: -webkit-linear-gradient(top, #2079b0, #2079b0);
					background-image: -moz-linear-gradient(top, #2079b0, #2079b0);
					background-image: -ms-linear-gradient(top, #2079b0, #2079b0);
					background-image: -o-linear-gradient(top, #2079b0, #2079b0);
					background-image: linear-gradient(to bottom, #2079b0, #2079b0); */
					/* 给按钮添加圆角 */
					-webkit-border-radius: 8;
					-moz-border-radius: 8;
					border-radius: 8px;
					/* text-shadow: 3px 2px 1px #9daef5; */
					-webkit-box-shadow: 6px 5px 24px #666666;
					-moz-box-shadow: 6px 5px 24px #666666;
					box-shadow: 6px 5px 24px #666666;
					font-family: Arial;
					color: #fafafa;
					font-size: 12px;
					padding: 10px;
					text-decoration: none;
					margin-right: 5px;
				}

				/* 悬停样式 */
				.btn:hover {
					background: #2079b0;
					/* background-image: -webkit-linear-gradient(top, #2079b0, #2079b0);
					background-image: -moz-linear-gradient(top, #2079b0, #2079b0);
					background-image: -ms-linear-gradient(top, #2079b0, #2079b0);
					background-image: -o-linear-gradient(top, #2079b0, #2079b0);
					background-image: linear-gradient(to bottom, #2079b0, #2079b0); */
					text-decoration: none;
				}

				.blink {
					font-size: 46px;
					color: #4cc134;
					margin: 10px;
					animation: changeshadow 1s ease-in infinite;
					/* 其它浏览器兼容性前缀 */
					-webkit-animation: changeshadow 1s linear infinite;
					-moz-animation: changeshadow 1s linear infinite;
					-ms-animation: changeshadow 1s linear infinite;
					-o-animation: changeshadow 1s linear infinite;
				}

				@keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}

				/* 添加兼容性前缀 */
				@-webkit-keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}

				@-moz-keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}

				@-ms-keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}

				@-o-keyframes changeshadow {
					0% {
						text-shadow: 0 0 4px #4cc134
					}

					50% {
						text-shadow: 0 0 40px #4cc134
					}

					100% {
						text-shadow: 0 0 4px #4cc134
					}
				}
			}
		</style>
		<script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "http://hm.baidu.com/hm.js?9940f26304b1f1a1a415df829cd440f3";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hm, s);
			})();
		</script>
	</body>
</html>
